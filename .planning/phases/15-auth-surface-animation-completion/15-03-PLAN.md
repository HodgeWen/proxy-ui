---
phase: 15-auth-surface-animation-completion
plan: 03
type: execute
wave: 2
depends_on: [15-01, 15-02]
files_modified:
  - web/src/lib/auth-surface-ui.ts
  - web/src/pages/Login.tsx
  - web/src/pages/Setup.tsx
  - .planning/REQUIREMENTS.md
autonomous: true
requirements: [UIANM-02, UIANM-04]
must_haves:
  truths:
    - "Login/Setup 使用同一来源的 auth 入场类与 75ms 节奏，避免后续页面漂移。"
    - "跨页面一致性巡检路径（login/setup/subscriptions/traffic/core）不再存在动效/hover parity 缺口。"
    - "UIANM-02 与 UIANM-04 在验证通过后回到 Complete 状态。"
  artifacts:
    - path: "web/src/lib/auth-surface-ui.ts"
      provides: "auth surface 入场与节奏共享常量"
      exports: ["AUTH_SURFACE_ENTRANCE_CLASS", "AUTH_SURFACE_STAGGER_MS"]
    - path: ".planning/REQUIREMENTS.md"
      provides: "UIANM-02/UIANM-04 完成态回填"
      contains: "UIANM-02|UIANM-04"
  key_links:
    - from: "web/src/lib/auth-surface-ui.ts"
      to: "web/src/pages/Login.tsx"
      via: "登录页引用统一 auth motion 常量"
      pattern: "AUTH_SURFACE_ENTRANCE_CLASS"
    - from: "web/src/lib/auth-surface-ui.ts"
      to: "web/src/pages/Setup.tsx"
      via: "设置页引用统一 auth motion 常量"
      pattern: "AUTH_SURFACE_ENTRANCE_CLASS"
    - from: ".planning/REQUIREMENTS.md"
      to: ".planning/ROADMAP.md"
      via: "Phase 15 requirement completion traceability 与路线图目标一致"
      pattern: "UIANM-02|UIANM-04"
---

<objective>
完成 Phase 15 收口：固化 Login/Setup 的共享动效基线，执行跨页面一致性巡检，并回填 UIANM requirement 完成态。

Purpose: 用“共享基线 + 审计闭环”防止 auth surface 在后续迭代中再次偏离全局动画与交互规范。
Output: 新增 auth surface 基线文件 + Login/Setup 统一引用 + REQUIREMENTS 状态回填。
</objective>

<execution_context>
@/home/whj/.claude/get-shit-done/workflows/execute-plan.md
@/home/whj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/15-auth-surface-animation-completion/15-RESEARCH.md
@.planning/phases/11-ui-animation-foundation/11-02-SUMMARY.md
@.planning/phases/14-ui-polish-consistency/14-01-SUMMARY.md
@web/src/pages/Login.tsx
@web/src/pages/Setup.tsx
@web/src/pages/Subscriptions.tsx
@web/src/pages/Traffic.tsx
@web/src/pages/Core.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: 提取并接入 auth surface 共享动效基线</name>
  <files>web/src/lib/auth-surface-ui.ts, web/src/pages/Login.tsx, web/src/pages/Setup.tsx</files>
  <action>新增 `web/src/lib/auth-surface-ui.ts`，导出 `AUTH_SURFACE_ENTRANCE_CLASS = "animate-in fade-in zoom-in-95 duration-300 fill-mode-both motion-reduce:animate-none"` 与 `AUTH_SURFACE_STAGGER_MS = 75`；Login/Setup 改为从该文件引用，不再在页面中硬编码入场类字符串或魔法数字；只做动效基线抽取，不改 auth API 交互和表单校验逻辑。</action>
  <verify>npm --prefix web run build && npm --prefix web exec eslint src/pages/Login.tsx src/pages/Setup.tsx src/lib/auth-surface-ui.ts</verify>
  <done>Login/Setup 的入场类与节奏来源统一且可复用，后续改动不会出现双处漂移。</done>
</task>

<task type="auto">
  <name>Task 2: 完成跨页一致性巡检并回填 requirement 状态</name>
  <files>.planning/REQUIREMENTS.md, web/src/pages/Login.tsx, web/src/pages/Setup.tsx, web/src/pages/Subscriptions.tsx, web/src/pages/Traffic.tsx, web/src/pages/Core.tsx</files>
  <action>执行一致性审计主路径：`/login -> /setup -> /subscriptions -> /traffic -> /core`，逐项确认（1）Login/Setup 卡片入场动效与基线一致且无 layout shift；（2）Login/Setup 操作控件 hover/focus 节奏与 Subscriptions/Traffic/Core 对齐；（3）reduced-motion 下 auth 入场关闭。若检查通过，将 `.planning/REQUIREMENTS.md` 中 `UIANM-02` 与 `UIANM-04` 由 pending 更新为 complete（含复选状态与 traceability 状态列）；若未通过，先修复 auth 页面再回填状态。</action>
  <verify>npm --prefix web run build，完成上述 5 页面手动巡检并记录结果后再检查 `.planning/REQUIREMENTS.md` 中 UIANM-02/UIANM-04 已为完成态。</verify>
  <done>跨页巡检无 parity gap，且 UIANM-02/UIANM-04 成功回填为 Complete。</done>
</task>

</tasks>

<verification>
1. `npm --prefix web run build` 通过。  
2. Login/Setup 均引用 `auth-surface-ui.ts` 中的统一入场常量与 75ms 节奏。  
3. 巡检 `/login`、`/setup`、`/subscriptions`、`/traffic`、`/core`：动效与 hover 体验一致。  
4. `.planning/REQUIREMENTS.md` 中 UIANM-02、UIANM-04 均标记为完成。
</verification>

<success_criteria>
- 满足 Success Criteria #3：一致性审计主路径无动效/hover 缺口。  
- 满足 Success Criteria #4：UIANM-02、UIANM-04 完成态回填。  
- Auth surface 基线沉淀为共享常量，降低后续回归风险。
</success_criteria>

<output>
After completion, create `.planning/phases/15-auth-surface-animation-completion/15-03-SUMMARY.md`
</output>
