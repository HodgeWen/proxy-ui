---
phase: 14-ui-polish-consistency
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/lib/core-status.ts
  - web/src/index.css
  - web/src/pages/Core.tsx
autonomous: true
requirements: [UICON-02]
must_haves:
  truths:
    - "核心状态点在 running/stopped/not_installed/error 四种状态下视觉可瞬时区分。"
    - "running 状态显示绿色脉冲，error 状态显示红色闪烁，stopped/not_installed 保持静态语义色。"
    - "开启 reduced-motion 时循环动画降级为静态，不影响状态识别。"
  artifacts:
    - path: web/src/lib/core-status.ts
      provides: "状态到指示点颜色/动效 class 的集中映射"
    - path: web/src/index.css
      provides: "error 状态 blink 动画 keyframes"
    - path: web/src/pages/Core.tsx
      provides: "消费状态元数据渲染指示点，不改状态来源与轮询机制"
  key_links:
    - from: web/src/lib/core-status.ts
      to: web/src/pages/Core.tsx
      via: "getStateMeta 输出 dotClassName，Core 页面直接消费"
      pattern: "getStateMeta|dotClassName|bg-emerald-500|bg-red-500"
    - from: web/src/index.css
      to: web/src/lib/core-status.ts
      via: "error 态 class 引用 status-blink keyframes"
      pattern: "@keyframes status-blink|animate-\\[status-blink"
    - from: web/src/pages/Core.tsx
      to: /api/core/status
      via: "继续使用既有 query/refetchInterval=5000 的状态来源"
      pattern: "queryKey: \\[\"core\", \"status\"\\]|refetchInterval: 5000"
---

<objective>
完成 Phase 14 的核心状态指示器动效落地（UICON-02）：在不改变状态契约与轮询边界的前提下，为四态提供统一且可识别的视觉语义。

Purpose: 提升核心状态可读性，让用户在 1 秒内分辨当前状态并降低误判。
Output: 状态元数据映射、error 闪烁 keyframes、Core 页面状态点渲染更新。
</objective>

<execution_context>
@/home/whj/.claude/get-shit-done/workflows/execute-plan.md
@/home/whj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/14-ui-polish-consistency/14-RESEARCH.md
@web/src/lib/core-status.ts
@web/src/index.css
@web/src/pages/Core.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: 扩展核心状态元数据以集中管理指示点动效</name>
  <files>web/src/lib/core-status.ts</files>
  <action>在 `STATE_META` 中为四态定义最终指示点 class（running=绿色 pulse、stopped=灰色静态、not_installed=黄色静态、error=红色 blink）；保持 `CoreState` 枚举、`ACTIONS_BY_STATE`、`normalizeCoreState` 语义不变，仅扩展视觉层映射；避免在页面内散落硬编码状态样式。</action>
  <verify>npm --prefix web run lint</verify>
  <done>核心状态视觉语义由单一元数据源集中维护，页面无需自行拼接状态颜色/动画规则。</done>
</task>

<task type="auto">
  <name>Task 2: 注入 error 闪烁动画并在 Core 页面消费状态映射</name>
  <files>web/src/index.css, web/src/pages/Core.tsx</files>
  <action>在 `index.css` 增加 `status-blink` keyframes（低风险 opacity 闪烁）并通过 `motion-reduce:animate-none` 支持 reduced-motion；在 `Core.tsx` 状态点处仅消费 `stateMeta.dotClassName` 渲染最终样式；禁止改动 `fetchStatus`、`queryKey`、`refetchInterval: 5000`、`useCoreUpdateStream` 相关逻辑，确保不突破既有 core 状态契约与轮询边界。</action>
  <verify>npm --prefix web run build</verify>
  <done>四态指示点动效完全按 UICON-02 生效，且状态来源与轮询/更新机制保持原状。</done>
</task>

</tasks>

<verification>
1) `npm --prefix web run lint` 与 `npm --prefix web run build` 均通过。  
2) 手动验证 `/core`：  
   - running：绿色脉冲；  
   - stopped：灰色静态；  
   - not_installed：黄色静态；  
   - error：红色闪烁。  
3) 开启系统 reduced-motion 后刷新页面，状态点动画应降级为静态。  
4) 确认核心状态仍来自既有 5s 轮询，更新进度仍由 SSE 驱动（无边界漂移）。
</verification>

<success_criteria>
- 满足 UICON-02：核心四态指示器动效与颜色语义完全落地且可立即区分。  
- 不新增 npm/Go 依赖。  
- 不改 core 状态契约、不改 TanStack Query 5s 轮询、不把状态检测迁移到 SSE。
</success_criteria>

<output>
After completion, create `.planning/phases/14-ui-polish-consistency/14-02-SUMMARY.md`
</output>
