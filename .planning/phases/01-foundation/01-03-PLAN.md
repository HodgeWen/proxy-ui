---
phase: 01-foundation
plan: 03
type: execute
wave: 3
depends_on: [02]
files_modified:
  - web/src/components/theme-provider.tsx
  - web/src/components/ui/sonner.tsx
  - web/src/components/layout/Sidebar.tsx
  - web/src/components/layout/AppLayout.tsx
  - web/src/pages/Dashboard.tsx
  - web/src/App.tsx
  - web/src/main.tsx
  - web/src/index.css
  - web/package.json
autonomous: true

must_haves:
  truths:
    - "界面使用暗色主题、shadcn/ui、中文语言"
    - "仪表盘显示 sing-box 状态卡片（运行/停止、版本号、运行时长）"
    - "重启 sing-box 时按钮 Loading，完成后恢复"
    - "配置应用成功/失败使用 Toast 通知（右上角）"
    - "sing-box check 验证失败时弹出 Modal 显示原始错误"
    - "侧边栏预留所有将来菜单项，未实现置灰/禁用"
  artifacts:
    - path: web/src/components/layout/Sidebar.tsx
      provides: 固定左侧边栏，含仪表盘、入站、用户、订阅、证书、流量、核心
      contains: "仪表盘|入站|用户|订阅"
    - path: web/src/pages/Dashboard.tsx
      provides: sing-box 状态卡片、重启按钮、统计概览占位（0）
      min_lines: 60
    - path: web/src/components/theme-provider.tsx
      provides: defaultTheme="dark"
      contains: "dark"
  key_links:
    - from: web/src/pages/Dashboard.tsx
      to: /api/core/status
      via: fetch or TanStack Query
      pattern: "api/core|useQuery"
    - from: web/src/pages/Dashboard.tsx
      to: /api/core/restart
      via: fetch POST
      pattern: "restart|api/core"
    - from: web/src/pages/Dashboard.tsx
      to: sonner
      via: toast.success / toast.error
      pattern: "toast\\."
---

<objective>
实现暗色主题 UI 框架、固定侧边栏、仪表盘（sing-box 状态卡片、重启、统计占位）、Toast/Modal 反馈。满足 UX-01～UX-05。

Purpose: 提供可用的管理面板界面，支持配置操作反馈与错误展示
Output: ThemeProvider、Sidebar、Dashboard、Sonner、Dialog（错误 Modal）
</objective>

<execution_context>
@/home/whj/.claude/get-shit-done/workflows/execute-plan.md
@/home/whj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: UI foundation (ThemeProvider, shadcn, Sidebar)</name>
  <files>web/package.json, web/src/main.tsx, web/src/App.tsx, web/src/index.css, web/src/components/theme-provider.tsx, web/src/components/layout/Sidebar.tsx, web/src/components/layout/AppLayout.tsx</files>
  <action>
建立 UI 基础（按 CONTEXT 锁定）：
- shadcn init: bunx shadcn@latest init（new-york、Tailwind v4 若可用）；bunx shadcn add sidebar dialog card skeleton button sonner
- ThemeProvider: defaultTheme="dark"，storageKey="s-ui-theme"
- 全局样式: 暗色深灰（#1a1a2e/#111827 色域），紫色强调色；无边框设计（背景色差+阴影）
- Sidebar: 固定左侧，Linear/Vercel 风格；菜单项：仪表盘(active)、入站、用户、订阅、证书、流量、核心；除仪表盘外均 disabled（未实现）
- AppLayout: Sidebar + 主内容区；Phase 1 仅桌面端
- 使用 bun 安装依赖（bun add react-bits）
- 界面语言中文
  </action>
  <verify>bun run dev 启动后可见暗色主题、左侧边栏、仪表盘可点击</verify>
  <done>暗色主题、Sidebar、AppLayout 就绪</done>
</task>

<task type="auto">
  <name>Task 2: Dashboard (sing-box status + restart)</name>
  <files>web/src/pages/Dashboard.tsx</files>
  <action>
实现仪表盘（按 CONTEXT 锁定）：
- sing-box 状态卡片: 显示运行/停止状态、版本号、运行时长（可选）；数据来自 GET /api/core/status
- 重启按钮: 调用 POST /api/core/restart；点击时 Loading 状态，完成后恢复
- 统计概览卡片: 入站数、用户数等占位，Phase 1 显示 0
- 使用 TanStack Query 拉取 status；restart 用 mutation
- 成功 Toast: toast.success("配置已应用") 或 toast.success("sing-box 已重启")
- 失败 Toast: toast.error("...")；若为 check 失败，同时打开 Modal 显示原始错误（pre/code 格式）
- Sonner position="top-right"，duration 约 4s
- react-bits 微交互: 卡片 hover、Modal 弹出等过渡动画（适中程度）
  </action>
  <verify>仪表盘显示版本与状态；点重启后按钮 Loading；成功/失败有 Toast；check 失败有 Modal</verify>
  <done>Dashboard 完整展示 sing-box 状态与操作反馈</done>
</task>

<task type="auto">
  <name>Task 3: Feedback polish (Toast, Modal, Loading)</name>
  <files>web/src/components/ui/sonner.tsx, web/src/pages/Dashboard.tsx, web/src/App.tsx</files>
  <action>
完善反馈与错误展示：
- Toaster: 全局挂载，position="top-right"
- 配置应用/重启成功: toast.success
- 配置验证失败: toast.error + 打开 Dialog 显示 check 原始输出（pre 代码块）
- 重启按钮: 使用 Button 的 disabled 或 loading 状态（shadcn Button 或自定义）
- 确保所有配置相关操作均通过 Toast/Modal 反馈，不跳转页面
- 参考 01-RESEARCH.md Sonner 与 Dialog 示例
  </action>
  <verify>重启成功有 Toast；模拟 check 失败时Modal 显示错误输出</verify>
  <done>Toast、Modal、Loading 反馈完整</done>
</task>

</tasks>

<verification>
- 暗色主题、中文界面
- 侧边栏含仪表盘+6 个预留项（disabled）
- Dashboard 显示 sing-box 版本、状态、重启按钮
- Toast 右上角、Modal 展示 check 错误
</verification>

<success_criteria>
1. 界面使用暗色主题、shadcn/ui、中文
2. 配置操作通过 Modal 表单完成（Phase 1 主要是重启，Toast+Modal 反馈）
3. 侧边栏预留完整导航结构
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
