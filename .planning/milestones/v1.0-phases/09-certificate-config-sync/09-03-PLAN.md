---
phase: 09-certificate-config-sync
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - .planning/phases/09-certificate-config-sync/09-VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "证书路径更新后，引用该证书的入站可立即生效，无需额外入站/用户变更触发"
  artifacts:
    - path: .planning/phases/09-certificate-config-sync/09-VERIFICATION.md
      provides: "Phase 9 验证检查清单"
      contains: "证书更新配置联动"
  key_links:
    - from: .planning/phases/09-certificate-config-sync/09-VERIFICATION.md
      to: "09-01 backend flow"
      via: "verification steps"
---

<objective>
补充 Phase 9 验证覆盖，确保证书路径更新后立即生效的审计缺口已闭环。

Purpose: 提供可执行的验证步骤，确认 Cert update -> Generate -> Apply -> Restart 全链路生效。
Output: 09-VERIFICATION.md 包含证书更新联动验证清单。
</objective>

<execution_context>
@/home/whj/.claude/get-shit-done/workflows/execute-plan.md
@/home/whj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-certificate-config-sync/09-RESEARCH.md
@.planning/v1.0-MILESTONE-AUDIT.md
@.planning/phases/09-certificate-config-sync/09-01-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: 创建 09-VERIFICATION.md 验证清单</name>
  <files>.planning/phases/09-certificate-config-sync/09-VERIFICATION.md</files>
  <action>
创建 .planning/phases/09-certificate-config-sync/09-VERIFICATION.md，包含：

1. **目标**：验证 Cert update -> Generate -> Apply -> Restart 闭环，满足 v1.0-MILESTONE-AUDIT 集成缺口。

2. **验证项**：
   - 09-01 后端：UpdateCertificateHandler 更新证书后自动 Generate -> ApplyConfig -> Restart
   - 09-01 回滚：ApplyConfig 失败时证书回滚，API 返回 400 {"error": "..."}
   - 09-02 前端：ApplyConfig 失败时 Modal 内显示 checkError
   - 09-03 联动：证书路径更新后，引用该证书的入站立即生效（无需编辑入站或用户）

3. **具体步骤**（可执行）：
   - 前置：创建证书 A，创建引用 cert A 的 VLESS 入站
   - 步骤 1：PUT /api/certs/:id 更新证书 A 的 fullchain_path/privkey_path
   - 步骤 2：读取 sing-box 配置文件或 GET /api/core/config，确认生成的 JSON 中该入站的 tls.certificate_path 已为新路径
   - 步骤 3：确认 sing-box 进程已重启（可检查进程或 /api/core/status）
   - 步骤 4：PUT 无效路径（如 /nonexistent/cert.pem），确认返回 400，证书未变更（GET /api/certs/:id 仍为旧值）

4. **成功标准**：上述步骤全部通过；审计缺口 "Cert update -> Generate -> Apply" 标记为已闭环。
</action>
  <verify>
ls -la /home/whj/codes/s-ui/.planning/phases/09-certificate-config-sync/09-VERIFICATION.md
</verify>
  <done>09-VERIFICATION.md 存在且包含可执行的验证步骤。</done>
</task>

</tasks>

<verification>
- 09-VERIFICATION.md 存在
- 验证步骤可被人工或自动化执行
</verification>

<success_criteria>
1. 09-VERIFICATION.md 包含证书更新联动验证清单
2. 验证项覆盖：后端流程、回滚、前端错误展示、证书路径立即生效
</success_criteria>

<output>
After completion, create `.planning/phases/09-certificate-config-sync/09-03-SUMMARY.md`
</output>
